{% extends "base.html" %}
{% block title %}Register{% endblock %}
{% block content %}
<h1>Register</h1>

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div style="padding: 10px; margin-bottom: 15px; border-radius: 5px; 
                  {% if category == 'error' %}background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;
                  {% elif category == 'success' %}background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;
                  {% endif %}">
        <strong>{{ category.title() }}:</strong> {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- âœ… PART D: CSRF Protection with FlaskForm -->
<form method="POST" novalidate>
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  
  <p>
    {{ form.username.label }}<br>
    {{ form.username(size=32) }}
    {% for error in form.username.errors %}
      <span style="color: red;">{{ error }}</span><br>
    {% endfor %}
  </p>
  
  <p>
    {{ form.password.label }}<br>
    {{ form.password(size=32) }}
    {% for error in form.password.errors %}
      <span style="color: red;">{{ error }}</span><br>
    {% endfor %}
  </p>
  
  <p>
    {{ form.bio.label }}<br>
    {{ form.bio(rows=4, cols=50) }}
    {% for error in form.bio.errors %}
      <span style="color: red;">{{ error }}</span><br>
    {% endfor %}
    <small style="color: #666;">HTML tags allowed: &lt;b&gt; &lt;i&gt; &lt;u&gt; &lt;em&gt; &lt;strong&gt; &lt;p&gt; &lt;br&gt;</small>
  </p>
  
  <p>
    {{ form.role.label }}<br>
    {{ form.role() }}
  </p>
  
  <p>{{ form.submit() }}</p>
</form>

<p>Already have an account? <a href="{{ url_for('main.login') }}">Login here</a></p>
{% endblock %}